<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Sebastian Gniazdowski">
<title>Zsh Native Scripting Handbook</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Zsh Native Scripting Handbook</h1>
<div class="details">
<span id="author" class="author">Sebastian Gniazdowski</span><br>
<span id="email" class="email"><a href="mailto:psprint@zdharma.org">psprint@zdharma.org</a></span><br>
<span id="revnumber">version 1.19,</span>
<span id="revdate">10/21/2018</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_information">Information</a>
<ul class="sectlevel2">
<li><a href="#at-sign-about-keeping-array-form">@ is about keeping array form</a></li>
<li><a href="#extended-glob">extended_glob</a></li>
</ul>
</li>
<li><a href="#_constructs">Constructs</a>
<ul class="sectlevel2">
<li><a href="#reading-a-file">Reading a file</a></li>
<li><a href="#reading-from-stdin">Reading from stdin</a></li>
<li><a href="#skipping-dirname-basename">Skipping dirname basename</a></li>
<li><a href="#resolve-symlinks">Resolve Symlinks</a></li>
<li><a href="#skipping-grep">Skipping grep</a></li>
<li><a href="#pattern-matching-in-and-fashion">Pattern matching in AND-fashion</a></li>
<li><a href="#skipping-tr">Skipping tr</a></li>
<li><a href="#ternary-expressions-1">Ternary expressions with <code>+,-,:+,:-</code> substitutions</a></li>
<li><a href="#ternary-expressions-2">Ternary expressions with <code>:#</code> substitution</a></li>
<li><a href="#built-in-regular-expressions-engine">Using built-in regular expressions engine</a></li>
<li><a href="#skipping-uniq">Skipping uniq</a></li>
<li><a href="#skipping-awk">Skipping awk</a></li>
<li><a href="#searching-arrays">Searching arrays</a></li>
<li><a href="#_code_execution_in_substitution">Code execution in <code>//</code> substitution</a></li>
<li><a href="#serializing-data">Serializing data</a></li>
</ul>
</li>
<li><a href="#rworld-ex">Real world examples</a>
<ul class="sectlevel2">
<li><a href="#git-subcmd-test">Testing for Git subcommand</a></li>
<li><a href="#unquoted-apostrophes-test">Counting unquoted-only apostrophes</a></li>
</ul>
</li>
<li><a href="#_tips_and_tricks">Tips and Tricks</a>
<ul class="sectlevel2">
<li><a href="#parsing-ini-file">Parsing INI file</a></li>
</ul>
</li>
<li><a href="#_revision_history_history_of_updates_to_the_document">Appendix A: Revision history (history of updates to the document)</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The handbook is also available as a <a href="Zsh-Native-Scripting-Handbook.pdf">PDF</a>.</p>
</div>
<div class="paragraph">
<p>This document has been created after 3.5 years of creating software for Zshell
and receiving help from IRC channel #zsh. Avoiding forks was the main guideline
when creating the projects and this lead to multiple discoveries of Zsh constructs
that are fast, robust and do not depend on external tools. Such code is more like
Ruby or Perl code, less like top-down shell scripts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_information">Information</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="at-sign-about-keeping-array-form">@ is about keeping array form</h3>
<div class="paragraph">
<p>How to access all array elements in a shell? The standard answer: <code>use @
subscript</code>, i.e. <code>${array[@]}</code>. However, this is the Bash &amp; Ksh way (and with
the option <code>KSH_ARRAYS</code>, Zsh also works this way, i.e. needs <code>@</code> to access
whole array). Zshell <strong>is different</strong>: it is <code>$array</code> that refers to all
elements anyway. There is no need of <code>@</code> subscript.</p>
</div>
<div class="paragraph">
<p>So what use has <code>@</code> in the Zsh-world? It is: &#8220;keep array form&#8221; or &#8220;do not
join&#8221;.  When is it activated? When user quotes the array, i.e. invokes
<code>"$array"</code>, he induces <strong>joining</strong> of all array elements (into a single string).
<code>@</code> is to have elements still quoted (so empty elements are
preserved), but not joined.</p>
</div>
<div class="paragraph">
<p>Two forms are available, <code>"$array[@]"</code> and <code>"${(@)array}"</code>. First form has
additional effect – when option <code>KSH_ARRAYS</code> is set, it indeed induces
referencing to whole array instead of first element only. It should then use
braces, i.e. <code>${array[@]}</code>, <code>"${array[@]}"</code> (<code>KSH_ARRAYS</code> requirement).</p>
</div>
<div class="paragraph">
<p>In practice, if you&#8217;ll use <code>@</code> as a subscript – <code>[@]</code>, not as a flag –
<code>${(@)&#8230;&#8203;}</code>, then you&#8217;ll make the code <code>KSH_ARRAYS</code>-compatible.</p>
</div>
</div>
<div class="sect2">
<h3 id="extended-glob">extended_glob</h3>
<div class="paragraph">
<p>Glob-flags <code>#b</code> and <code>#m</code> require <code>setopt extended_glob</code>. Patterns utilizing <code>~</code>
and <code>^</code> also require it. Extended-glob is one of the main features of Zsh.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_constructs">Constructs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="reading-a-file">Reading a file</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">declare -a lines; lines=( "${(@f)"$(&lt;path/file)"}" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>This preserves empty lines because of double-quoting (the outside one).
<code>@</code>-flag is used to obtain array instead of scalar. If you don&#8217;t want empty
lines preserved, you can also skip <code>@</code>-splitting, as it is explained in
Information section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">declare -a lines; lines=( ${(f)"$(&lt;path/file)"} )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: <code>$(&lt;&#8230;&#8203;)</code> construct strips trailing empty lines.</p>
</div>
</div>
<div class="sect2">
<h3 id="reading-from-stdin">Reading from stdin</h3>
<div class="paragraph">
<p>This topic is governed by the same principles a the previous paragraph
(<code>Reading a file</code>), with the single difference that instead of the substitution
<code>"$(&lt;file-path)"</code> the substitution that should be used is <code>"$(command arg1
&#8230;&#8203;)"</code>, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">declare -a lines; lines=( ${(f)"$(command arg1 ...)"} )</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will read the <code>command&#8217;s</code> output into the array <code>lines</code>. The version that
does <code>@</code> splitting and retains any empty lines is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">declare -a lines; lines=( "${(f@)$(command arg1 ...)}" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that instead of four double-quotes <code>"</code>, an idiom that is justified (simply
suggested) by the Zsh documentation (and was used in the previous paragraph, in
the snippet <code>&#8230;&#8203; "${(@f)"$(&lt;path/file)"}" &#8230;&#8203;</code>), only <strong>two</strong> double-quotes are
being used. I&#8217;ve investigated this form with the main Zsh developers on the
<code>zsh-workers@zsh.org</code> mailing list, and it was clearly stated that single,
outside quoting of <code>${(f@)&#8230;&#8203;}</code> substitution works as if it was also separately
applied to <code>$(command &#8230;&#8203;)</code> (or to <code>$(&lt;file-path)</code>) inner substitution, so the
second double-quoting isn&#8217;t actually needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="skipping-dirname-basename">Skipping dirname basename</h3>
<div class="paragraph">
<p><code>dirname</code> and <code>basename</code> can be skipped by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">local dirname="${PWD:h}"
local basename="${PWD:t}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more about <a href="http://zsh.sourceforge.net/Doc/Release/Expansion.html#Modifiers">modifiers</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="resolve-symlinks">Resolve Symlinks</h3>
<div class="paragraph">
<p>Symbolic links can be turned into an absolute path with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">local absolute_path="${PWD:A}"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="skipping-grep">Skipping grep</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">declare -a lines; lines=( "${(@f)"$(&lt;path/file)"}" )
declare -a grepped; grepped=( ${(M)lines:#*query*} )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have <code>grep -v</code> effect, skip <code>M</code>-flag. To grep case insensitively, use <code>#i</code> glob
flag (<code>&#8230;&#8203;:#(#i)*query*}</code>).</p>
</div>
<div class="paragraph">
<p>As it can be seen, <code>${&#8230;&#8203;:#&#8230;&#8203;}</code> substitution is a filtering of array, which by
default filters-out elements (<code>(M)</code> flag induces the opposite behavior). When
used with string, not an array, it behaves similarily: returns empty string when
<code>{input_string_var:#pattern}</code> matches whole input string.</p>
</div>
<div class="paragraph">
<p>Side-note: <code>(M)</code> flag can be used also with <code>${(M)var#pattern}</code> and other
substitutions, to retain what&#8217;s matched by the pattern instead of removing that.</p>
</div>
<div class="sect3">
<h4 id="multi-line-grep">Multi-line matching like with grep</h4>
<div class="paragraph">
<p>Suppose you have a Subversion repository and want to check if it contains files
being not under version control. You could do this in Bash style like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">local svn_status="$(svn status)"
if [[ -n "$(echo "$svn_status" | \grep \^\?)" ]]; then
    echo found
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>That are 3 forks: for <code>svn status</code>, for <code>echo</code> and for <code>grep</code>. This can be solved
by <code>:#</code> substitution and <code>(M)</code> flag described above in this section (just check
if the number of matched lines is greater than 0). However, there&#8217;s a more direct
approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">local svn_status="$(svn status)" nl=$'\n'
if [[ "$svn_status" = *((#s)|$nl)\?* ]]; then
  echo found
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>This requires <code>extendedglob</code>. The <code>(#s)</code> means: "start of the string". So
<code>((#s)|$nl)</code> means "start of the string OR preceded by a new-line".</p>
</div>
<div class="paragraph">
<p>If the <code>extendedglob</code> option cannot be used for some reason, this can be
achieved also
without it, but essentially it means that alternative (i.e. <code>|</code>) of two
versions of the pattern will have to be matched:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">setopt localoptions noextendedglob
local svn_status="$(svn status)" nl=$'\n'
if [[ "$svn_status" = (\?*|*$nl\?*) ]]; then
  echo found
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, multi-line matching falls into the following idiom (<code>extendedglob</code>
version):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh">local needle="?" required_preceding='[[:space:]]#'
[[ "$(svn status)" = *((#s)|$nl)${~required_preceding}${needle}* ]] &amp;&amp; echo found</code></pre>
</div>
</div>
<div class="paragraph">
<p>It does a single fork (calls <code>svn status</code>). The <code>${~variable}</code> means (the <code>~</code>
in it): "the variable is holding a pattern, interpret it". All in all, instead
of regular expressions we were using patterns (globs) (see
<a href="#built-in-regular-expressions-engine">this section</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pattern-matching-in-and-fashion">Pattern matching in AND-fashion</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">[[ "abc xyz efg" = *abc*~^*efg* ]] &amp;&amp; print Match found</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>~</code> is a negation&#8201;&#8212;&#8201;<code>match *abc* but not &#8230;&#8203;</code>. Then, <code>^</code> is also a negation.
The effect is: <code>*abc* but not those that don&#8217;t have *efg*</code> which equals to:
<code>*abc* but those that have also *efg*</code>. This is a regular pattern and it can
be used with <code>:#</code> above to search arrays, or with <code>R</code>-subscript flag to search
hashes (<code>${hsh[(R)*pattern*]}</code>), etc. Inventor of those patterns is Mikael
Magnusson.</p>
</div>
</div>
<div class="sect2">
<h3 id="skipping-tr">Skipping tr</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -A map; map=( a 1 b 2 );
text=( "ab" "ba" )
text=( ${text[@]//(#m)?/${map[$MATCH]}} )
print $text ▶ 12 21</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>#m</code> flag enables the <code>$MATCH</code> parameter. At each <code>//</code> substitution, <code>$map</code> is
queried for character-replacement. You can substitute a text variable too, just
skip <code>[@]</code> and parentheses in assignment.</p>
</div>
</div>
<div class="sect2">
<h3 id="ternary-expressions-1">Ternary expressions with <code>+,-,:+,:-</code> substitutions</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">HELP="yes"; print ${${HELP:+help enabled}:-help disabled} ▶ help enabled
HELP=""; print ${${HELP:+help enabled}:-help disabled} ▶ help disabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ternary expression is known from <code>C</code> language but exists also in Zsh, but
directly only in math context, i.e. <code>(( a = a &gt; 0 ? b : c ))</code>. Flexibility of
Zsh allows such expressions also in normal context. Above is an example. <code>:+</code> is
"if not empty, substitute …" <code>:-</code> is "if empty, substitute …". You can save
great number of lines of code with those substitutions, it&#8217;s normally at least
4-lines <code>if</code> condition or lenghty <code>&amp;&amp;</code>/<code>||</code> use.</p>
</div>
</div>
<div class="sect2">
<h3 id="ternary-expressions-2">Ternary expressions with <code>:#</code> substitution</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">var=abc; print ${${${(M)var:#abc}:+is abc}:-not abc} ▶ is abc
var=abcd; print ${${${(M)var:#abc}:+is abc}:-not abc} ▶ not abc</code></pre>
</div>
</div>
<div class="paragraph">
<p>An one-line "if var = x, then …, else …". Again, can spare a great amount of boring
code that makes 10-line function a 20-line one.</p>
</div>
</div>
<div class="sect2">
<h3 id="built-in-regular-expressions-engine">Using built-in regular expressions engine</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">[[ "aabbb" = (#b)(a##)*(b(#c2,2)) ]] &amp;&amp; print ${match[1]}-${match[2]} ▶ aa-bb</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>##</code> is: "1 or more". <code>(#c2,2)</code> is: "exactly 2". A few other constructs: <code>#</code> is
"0 or more", <code>?</code> is "any character", <code>(a|b|)</code> is "a or b or empty match". <code>#b</code>
enables the <code>$match</code> parameters. There&#8217;s also <code>#m</code> but it has one parameter
<code>$MATCH</code> for whole matched text, not for any parenthesis.</p>
</div>
<div class="paragraph">
<p>Zsh patterns are basically a custom regular expressions engine. They are
slightly faster than <code>zsh/regex</code> module (used for <code>=~</code> operator) and don&#8217;t have
that dependency (regex module can be not present, e.g. in default static build
of Zsh). Also, they can be used in substitutions, for example in <code>//</code>
substitution.</p>
</div>
</div>
<div class="sect2">
<h3 id="skipping-uniq">Skipping uniq</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -aU array; array=( a a b ); print $array ▶ a b
declare -a array; array=( a a b ); print ${(u)array} ▶ a b</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable <code>-U</code> flag for array so that it guards elements to be unique, or use
<code>u</code>-flag to uniquify elements of any array.</p>
</div>
</div>
<div class="sect2">
<h3 id="skipping-awk">Skipping awk</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -a list; list=( "a,b,c,1,e" "p,q,r,2,t" );
print "${list[@]/(#b)([^,]##,)(#c3,3)([^,]##)*/${match[2]}}" ▶ 1 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pattern specifies 3 blocks of <code>[^,]##,</code> so 3 "not-comma multiple times, then
comma", then single block of "not-comma multiple times" in second parentheses&#8201;&#8212;&#8201;and then replaces this with second parentheses. Result is 4th column extracted
from multiple lines of text, something <code>awk</code> is often used for. Other method is
use of <code>s</code>-flag. For single line of text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">text="a,b,c,1,e"; print ${${(s:,:)text}[4]} ▶ 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to in-substitution code-execution capabilities it&#8217;s possible to use
<code>s</code>-flag to apply it to multiple lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -a list; list=( "a,b,c,1,e" "p,q,r,2,t" );
print "${list[@]/(#m)*/${${(s:,:)MATCH}[4]}}" ▶ 1 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a problem with the <code>(s::)</code> flag that can be solved if Zsh is version
<code>5.4</code> or higher: if there will be single input column, e.g. <code>list=( "column1"
"a,b")</code> instead of two or more columns (i.e. <code>list=( "column1,column2" "a,b"
)</code>), then <code>(s::)</code> will return <strong>string</strong> instead of 1-element <strong>array</strong>. So the
index <code>[4]</code> in above snippet will index a string, and show its 4-th letter.
Starting with Zsh 5.4, thanks to a patch by Bart Schaefer (<code>40640: the (A)
parameter flag forces array result even if&#8230;&#8203;</code>), it is possible to force
<strong>array</strong>-kind of result even for single column, by adding <code>(A)</code> flag, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -a list; list=( "a,b,c,1,e" "p,q,r,2,t" "column1" );
print "${list[@]/(#m)*/${${(As:,:)MATCH}[4]}}" ▶ 1 2
print "${list[@]/(#m)*/${${(s:,:)MATCH}[4]}}" ▶ 1 2 u</code></pre>
</div>
</div>
<div class="paragraph">
<p>Side-note: <code>(A)</code> flag is often used together with <code>::=</code> assignment-substitution
and <code>(P)</code> flag, to assign arrays and hashes by-name.</p>
</div>
</div>
<div class="sect2">
<h3 id="searching-arrays">Searching arrays</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -a array; array=( a b " c1" d ); print ${array[(r)[[:space:]][[:alpha:]]*]} ▶ c1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>[[:space:]]</code> contains unicode spaces. This is often used in conditional
expression like <code>[[ -z ${array[(r)&#8230;&#8203;]} ]]</code>.</p>
</div>
<div class="paragraph">
<p>Note that <a href="#skipping-grep">Skipping grep</a> that uses <code>:#</code> substitution can also be
used to search arrays.</p>
</div>
</div>
<div class="sect2">
<h3 id="_code_execution_in_substitution">Code execution in <code>//</code> substitution</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">append() { gathered+=( $array[$1] ); }
functions -M append 1 1 append
declare -a array; array=( "Value 1" "Other data" "Value 2" )
declare -a gathered; integer idx=0
: ${array[@]/(#b)(Value ([[:digit:]]##)|*)/$(( ${#match[2]} &gt; 0 ? append(++idx) : ++idx ))}
print $gathered ▶ Value 1 Value 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use of <code>#b</code> glob flag enables math-code execution (and not only) in <code>/</code> and <code>//</code>
substitutions. Implementation is very fast.</p>
</div>
</div>
<div class="sect2">
<h3 id="serializing-data">Serializing data</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">declare -A hsh deserialized; hsh=( key value )
serialized="${(j: :)${(qkv@)hsh}}"
deserialized=( "${(Q@)${(z@)serialized}}" )
print ${(kv)deserialized} ▶ key value</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>j</code>-flag means join&#8201;&#8212;&#8201;by spaces, in this case. Flags <code>kv</code> mean: keys and values,
interleaving. Important <code>q</code>-flag means: quote. So what is obtained is each key
and value quoted, and put into string separated by spaces.</p>
</div>
<div class="paragraph">
<p><code>z</code>-flag means: split as if Zsh parser would split. So quoting (with backslashes,
double quoting and other) is recognized. Obtained is array <code>( "key" "value")</code>
which is then dequoted with <code>Q</code>-flag. This yields original data, assigned to
hash <code>deserialized</code>. Use this to e.g. implement array of hashes.</p>
</div>
<div class="paragraph">
<p>Note: to be compatible with <code>setopt ksharrays</code>, use <code>[@]</code> instead of <code>(@)</code>, e.g.:
<code>&#8230;&#8203;( "${(Q)${(z)serialized[@]}[@]}" )</code></p>
</div>
<div class="sect4">
<h5 id="tip-serializing-with-bash">Tip: serializing with Bash</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">array=( key1 key2 )
printf -v serialized "%q " "${array[@]}"
eval "deserialized=($serialized)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method works also with Zsh. The drawback is use of <code>eval</code>, however it&#8217;s
impossible that any problem will occurr unless someone compromises variable&#8217;s
value, but as always, <code>eval</code> should be avoided if possible.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rworld-ex">Real world examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="git-subcmd-test">Testing for Git subcommand</h3>
<div class="paragraph">
<p>Following code checks if there is a <code>git</code> subcommand <code>$mysub</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">if git help -a | grep "^  [a-z]" | tr ' ' '\n' | grep -x $mysub &gt; /dev/null &gt; /dev/null; then</code></pre>
</div>
</div>
<div class="paragraph">
<p>That are <code>4</code> forks. The code can be replaced according to this guide:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">local -a lines_list
lines_list=( ${(f)"$(git help -a)"} )
lines_list=( ${(M)${(s: :)${(M)lines_list:#   [a-z]*}}:#$mysub} )
if (( ${#lines_list} &gt; 0 )); then
    …
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is just <code>1</code> fork.</p>
</div>
</div>
<div class="sect2">
<h3 id="unquoted-apostrophes-test">Counting unquoted-only apostrophes</h3>
<div class="paragraph">
<p>A project was needing this to do some Zle line-continuation tricks (when you
put a backslash-\ at the end of the line and press enter – it is the
line-continuation that occurs at that moment).</p>
</div>
<div class="paragraph">
<p>The required functionality is: in given string, count the number of
apostrophes, but <em>only the unquoted ones</em>. This means that only apostrophes
with null or an even number of preceding backslashes should be accepted into
the count:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">buf="word'continue\'after\\\'afterSecnd\\''afterPair"
integer count=0
: ${buf//(#b)((#s)|[^\\])([\\][\\])#(\'\'#)/$(( count += ${#match[3]} ))}
echo $count ▶ 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The answer (i.e. the output) to the above presentation and example is: <code>3</code>
(there are <code>3</code> unquoted apostrophes in total in the string kept in the variable
<code>$buf</code>).</p>
</div>
<div class="paragraph">
<p>Below follows a variation of above snippet that doesn&#8217;t use math-code execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="none">buf="word'continue\'after\\\'afterSecnd\\''afterPair"
buf="${(S)buf//(#b)*((#s)|[^\\])([\\][\\])#(\'\'#)*/${match[3]}}"; buf=${buf%%[^\']##}
integer count=${#buf}
echo $count ▶ 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is possible thanks to <code>(S)</code> flag – non-greedy matching, <code>([\\][\\])<mark></code> trick – it
matches only unquoted following <code>(\'\'</mark>#)</code> characters (which are the apostrophes) and
a general strategy to replace <code>anything-apostrope(s)</code> (unquoted ones) with
<code>the-apostrope(s)</code> (and then count them with <code>${#buf}</code>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tips_and_tricks">Tips and Tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="parsing-ini-file">Parsing INI file</h3>
<div class="paragraph">
<p>With Zshell&#8217;s <code>extended_glob</code> parsing an <code>ini</code> file is an easy task. It will not
result in a nested-arrays data structure (Zsh doesn&#8217;t support nested hashes),
but the hash keys like <code>$DB_CONF[db1_&lt;connection&gt;_host]</code> are actually really
intuitive.</p>
</div>
<div class="paragraph">
<p>The code should be placed in file named <code>read-ini-file</code>, in <code>$fpath</code>, and
<code>autoload read-ini-file</code> should be invoked.</p>
</div>
<div id="read-ini-file" class="listingblock">
<div class="title">read-ini-file</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="zsh"># Copyright (c) 2018 Sebastian Gniazdowski
#
# $1 - path to the ini file to parse
# $2 - name of output hash
# $3 - prefix for keys in the hash
#
# Writes to given hash under keys built in following way: ${3}&lt;section&gt;_field.
# Values are values from ini file. Example invocation:
#
# read-ini-file ./database1-setup.ini DB_CONF db1_
# read-ini-file ./database2-setup.ini DB_CONF db2_
#

setopt localoptions extendedglob

local __ini_file="$1" __out_hash="$2" __key_prefix="$3"
local IFS='' __line __cur_section="void" __access_string
local -a match mbegin mend

[[ ! -r "$__ini_file" ]] &amp;&amp; { builtin print -r "read-ini-file: an ini file is unreadable ($__ini_file)"; return 1; }

while read -r -t 1 __line; do
    if [[ "$__line" = [[:blank:]]#\;* ]]; then
        continue
    # Match "[Section]" line
    elif [[ "$__line" = (#b)[[:blank:]]#\[([^\]]##)\][[:blank:]]# ]]; then
        __cur_section="${match[1]}"
    # Match "string = string" line
    elif [[ "$__line" = (#b)[[:blank:]]#([^[:blank:]=]##)[[:blank:]]#[=][[:blank:]]#(*) ]]; then
        match[2]="${match[2]%"${match[2]##*[! $'\t']}"}" # severe trick - remove trailing whitespace
        __access_string="${__out_hash}[${__key_prefix}&lt;$__cur_section&gt;_${match[1]}]"
        : "${(P)__access_string::=${match[2]}}"
    fi
done &lt; "$__ini_file"

return 0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history_history_of_updates_to_the_document">Appendix A: Revision history (history of updates to the document)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>v1.19, 11/05/2018: Less abstract but more true function of <code>@</code> (flag, subscript)<br>
v1.18, 10/21/2018: Multi-line matching like with <code>grep</code><br>
v1.16, 10/21/2018: Count apostrophes example – additional version without math-code<br>
v1.15, 10/21/2018: Inform about potential (s::)-flag problems ("Skipping awk")<br>
v1.1, 10/21/2018: Elaborate on (M)-flag in "Skipping grep" section<br>
v1.05, 10/21/2018: New section "Reading from stdin"<br>
v1.0, 09/29/2018: New real world examples (<code>git help -a</code> and "Counting apostrophes")<br></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.19<br>
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>